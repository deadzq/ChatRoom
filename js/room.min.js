function initialize(){messagesRef.once("value",function(e){get_time=e.numChildren(),lastpoint=get_time-21})}function setUserStatus(e){myUserRef.set({name:loginUser,status:e})}var loginUser=location.href.split("?")[1],locate="https://bbape2.firebaseio.com/user/"+loginUser,messagesRef=new Firebase("https://bbape2.firebaseio.com/messages"),get_time=0,app=document.querySelector("#app");app.page=0,$(document).ready(function(){initialize(),setTimeout(function(){0==loginUser.length&&(loginUser="anonymous"),document.getElementById("ker").setAttribute("login-user",loginUser)},500)});var userListRef=new Firebase("https://bbape2.firebaseio.com/onlineusers"),myUserRef=userListRef.push(),connectedRef=new Firebase("https://bbape2.firebaseio-demo.com//.info/connected"),counter=0;userListRef.once("value",function(){userListRef.on("child_added",function(e){e.val().name==loginUser&&counter++}),0==counter&&setUserStatus("online")}),userListRef.on("child_removed",function(e){e.val().name==loginUser&&counter--,0==counter&&setUserStatus("online")}),userListRef.on("value",function(e){app.occupancy=e.numChildren()}),connectedRef.on("value",function(e){e.val()&&myUserRef.onDisconnect().remove()}),app.handleKeyup=function(e){if(13==e.keyCode){if(app.inputMeg){var t=app.inputMeg;messagesRef.push({name:loginUser,text:t,time:get_time}),get_time++}app.inputMeg=""}},app.handleTap=function(){if(app.inputMeg){var e=app.inputMeg;messagesRef.push({name:loginUser,text:e,time:get_time}),get_time++}app.inputMeg=""},app.handleClickPublic=function(){messagesRef=messagesRef.root().child("messages"),document.querySelector("#header").innerHTML="Public Room";var e=document.querySelector("paper-drawer-panel");e.togglePanel()},app.handleClickPrivate=function(){messagesRef=messagesRef.root().child("user").child(loginUser),document.querySelector("#header").innerHTML="Private Space";var e=document.querySelector("paper-drawer-panel");e.togglePanel(),$("private-list").attr("location",locate),$("private-list").attr("login-user",loginUser)},app.handleScroll=function(){var e=document.querySelector("iron-pages");frontHeight=e.scrollHeight,frontTop=e.scrollTop,e.scrollTop<=300&&(0==app.page&&lastpoint>=0?($("message-list").prepend('<more-messagelist login-user="'+loginUser+'" endat="'+lastpoint+'" front-height="'+frontHeight+'" front-top="'+frontTop+'"></more-messagelist>'),lastpoint-=15):1==app.page&&lastpoint>=0&&($("private-list").prepend('<more-privatelist login-user="'+loginUser+'" endat="'+lastpoint+'" location="'+locate+'"></more-privatelist>'),lastpoint-=15))};
